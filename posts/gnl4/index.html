<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Get Next Line ④ 프로젝트 구현 (Mandatory, Bonus part)" /><meta property="og:locale" content="en" /><meta name="description" content="Mandatory part 과제 설명" /><meta property="og:description" content="Mandatory part 과제 설명" /><link rel="canonical" href="https://23tae.github.io/posts/gnl4/" /><meta property="og:url" content="https://23tae.github.io/posts/gnl4/" /><meta property="og:site_name" content="Justnote" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-03T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Get Next Line ④ 프로젝트 구현 (Mandatory, Bonus part)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="pwyVnBftLVRWrdN-N6v3WUvcMGKWdWZQe6eilBPgBJc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-06T14:17:27+09:00","datePublished":"2022-06-03T00:00:00+09:00","description":"Mandatory part 과제 설명","headline":"Get Next Line ④ 프로젝트 구현 (Mandatory, Bonus part)","mainEntityOfPage":{"@type":"WebPage","@id":"https://23tae.github.io/posts/gnl4/"},"url":"https://23tae.github.io/posts/gnl4/"}</script><title>Get Next Line ④ 프로젝트 구현 (Mandatory, Bonus part) | Justnote</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Justnote"><meta name="application-name" content="Justnote"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Justnote</a></div><div class="site-subtitle font-italic">배운 내용을 기록하는 곳</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/23tae" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['taehoonkim.dev','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Get Next Line ④ 프로젝트 구현 (Mandatory, Bonus part)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Get Next Line ④ 프로젝트 구현 (Mandatory, Bonus part)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1654182000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 3, 2022 </em> </span> <span> Updated <em class="" data-ts="1657084647" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 6, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/23tae">Taehoon</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1691 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h1 id="mandatory-part">Mandatory part</h1><h2 id="과제-설명"><span class="mr-2">과제 설명</span><a href="#과제-설명" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">char *get_next_line(int fd);</code></p><ul><li>매개변수<ul><li>fd: 읽어야 할 파일의 디스크립터</ul><li>반환값<ul><li>읽은 line: 한 줄을 제대로 읽음<li>NULL : 더이상 읽을게 없음 or 에러 발생</ul><li>사용가능 외부함수<ul><li>read, malloc, free</ul></ul><h2 id="gnl"><span class="mr-2">gnl</span><a href="#gnl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>각각의 함수의 역할은 다음과 같다.</p><p><strong>get_next_line</strong> : 3개의 함수를 호출<br /> <strong>ft_read_data</strong> : 데이터를 개행문자가 나올때까지 버퍼크기만큼 읽고 저장<br /> <strong>ft_extract_line</strong> : 맨 앞부터 개행문자까지 저장<br /> <strong>ft_save_rest</strong> : 개행문자 뒷부분 저장</p><h3 id="get_next_line"><span class="mr-2">get_next_line</span><a href="#get_next_line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>전체적인 동작을 관리하는 함수</p></blockquote><p>ex) text : <code class="language-plaintext highlighter-rouge">abc\nde\nf\0</code></p><ul><li>변수<ul><li><code class="language-plaintext highlighter-rouge">char *line;</code> : <strong>한 줄+개행문자</strong>를 저장해 리턴할 변수<li><code class="language-plaintext highlighter-rouge">static char *backup;</code> : 다음에 읽을 데이터의 시작 주소<div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kt">char</span> <span class="o">*</span><span class="n">text</span> <span class="o">=</span> <span class="s">"abc</span><span class="se">\n</span><span class="s">de</span><span class="se">\n</span><span class="s">f"</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">line</span> <span class="o">=</span> <span class="s">"abc</span><span class="se">\n</span><span class="s">"</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">backup</span> <span class="o">=</span> <span class="s">"de</span><span class="se">\n</span><span class="s">f"</span>
<span class="c1">// 전부 맨 뒤에 '\0' 포함</span>
</pre></table></code></div></div></ul><li>fd 유효성 체크<li>정적변수의 사용<br /> <code class="language-plaintext highlighter-rouge">static char *backup;</code><br /> 정적변수의 특성상 함수가 종료되어도 저장해놓은 문자열을 잃지 않음<br /> 지역변수로 선언되었다면 문자열을 잃어버려 메모리 누수 발생함</ul><h3 id="ft_read_data"><span class="mr-2">ft_read_data</span><a href="#ft_read_data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>데이터를 읽고 ‘\n’이 나올때까지의 line을 BUFFER_SIZE의 배수만큼 읽어들여 반환</p></blockquote><p>ex) BUFFER_SIZE : 3, backup : <code class="language-plaintext highlighter-rouge">abc\nde</code></p><ul><li>변수<ul><li><code class="language-plaintext highlighter-rouge">char *buffer;</code> : read해서 저장해 둘 데이터의 시작주소<li><code class="language-plaintext highlighter-rouge">int bytes_read</code> : read한 데이터의 바이트수</ul><li>동작방식<ul><li>read로 읽고 bytes_read에 읽은 바이트 저장<li>bytes_read로 read함수가 읽어들인 바이트 체크(0,-1,나머지)<li>strchr로 개행문자 체크<li><code class="language-plaintext highlighter-rouge">buffer[bytes_read]=0</code> : 버퍼의 데이터를 문자열로 만듦<li>기존 backup에 읽어들인 buffer 이어붙임(ft_strjoin 기존함수와의 차이점: NULL이 들어왔을 때 처리)<li>buffer 메모리 해제 후 backup 반환</ul><li>기타<ul><li>buffer 변수를 동적할당할 때 malloc 대신 calloc을 사용한 이유?<br /> → 맨 처음 while문이 동작할 때 buffer 안에는 쓰레기값이 들어있으므로 strchr이 ‘\n’을 검색하는 과정에서 의도치 않게 동작할 수 있음<li>strchr이 backup이 아닌 buffer를 탐색하는 이유?<br /> → backup의 경우 행의 길이가 길어지면 while문을 반복하는 동안 탐색했던 위치를 재탐색하는 비효율적인 과정을 거치게됨</ul></ul><h3 id="ft_extract_line"><span class="mr-2">ft_extract_line</span><a href="#ft_extract_line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>backup[fd]에서 \n을 포함한 앞부분 분리(리턴할 line)</p></blockquote><p>ex) line : <code class="language-plaintext highlighter-rouge">abc\n\0</code></p><ul><li>변수<ul><li><code class="language-plaintext highlighter-rouge">char *line</code> : 인수로 들어온 backup에서 개행문자 뒷부분을 제외한 데이터의 시작주소<li><code class="language-plaintext highlighter-rouge">int i</code> : backup과 line 배열의 인덱스</ul><li>동작방식<ul><li>null값 처리<li>backup 배열의 값이 ‘\0’이거나 ‘\n’일 때까지 뒤로 이동해서 끝위치 파악<li>파악한 위치 활용해서 line에 메모리 할당(끝에 ‘\n’과 ‘\0’자리 포함)<li>다시 맨 앞부터 메모리 복사<li>맨 끝이 개행문자다? 개행저장하고 다음값을 null로<li>아니다? null만 복사<li>만든 line 반환</ul></ul><h3 id="ft_save_rest"><span class="mr-2">ft_save_rest</span><a href="#ft_save_rest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>backup[fd]에서 \n을 제외한 뒷부분 분리(저장할 부분)</p></blockquote><p>ex) rest : <code class="language-plaintext highlighter-rouge">de\0</code></p><ul><li>변수<ul><li><code class="language-plaintext highlighter-rouge">char *rest</code> : backup에서 개행문자 뒷부분을 저장할 포인터<li><code class="language-plaintext highlighter-rouge">int idx1</code> : backup 배열의 인덱스<li><code class="language-plaintext highlighter-rouge">int idx2</code> : rest 배열의 인덱스</ul><li>동작방식<ul><li>backup의 맨 처음부분부터 돌면서 개행문자나 널문자가 나올때까지 이동<li>그대로 끝난다면 backup을 해제하고 널 반환<li>rest에 메모리 할당(<code class="language-plaintext highlighter-rouge">ft_strlen(backup) - idx1 + 1</code> : 뒷부분길이 + 널값)<li>rest에 backup 뒷부분을 저장 후 backup은 메모리 해제</ul></ul><h2 id="gnl_utils"><span class="mr-2">gnl_utils</span><a href="#gnl_utils" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>사용한 함수<ul><li>ft_strlen<li>ft_strlcpy-strjoin에서 사용<li>ft_strchr<li>ft_strjoin<li>ft_calloc</ul><li>기존 libft와의 차이점<ul><li>ft_calloc<ul><li><code class="language-plaintext highlighter-rouge">count * size &gt; SIZE_MAX</code> 처리하는 부분 제외</ul><li>ft_strjoin<ul><li><p>앞부분 인수로 들어온 s1이 NULL일 경우 크기가 1인 메모리공간을 할당함 (맨 처음에 backup이 아무곳도 가리키지 않는 경우)</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s1</span><span class="p">)</span>
  	<span class="p">{</span>
  		<span class="n">s1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
  		<span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
  	<span class="p">}</span>
</pre></table></code></div></div><li><p>끝부분에 s1을 free함</p></ul></ul></ul><h2 id="header"><span class="mr-2">header</span><a href="#header" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>get_next_line.h</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#ifndef GET_NEXT_LINE_H
# define GET_NEXT_LINE_H
</span>
<span class="cp"># include &lt;stdlib.h&gt;
# include &lt;unistd.h&gt;
</span>
<span class="cp"># ifndef BUFFER_SIZE
#  define BUFFER_SIZE 50
# endif
</span>
<span class="c1">// gnl</span>
<span class="kt">char</span>	<span class="o">*</span><span class="nf">get_next_line</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>

<span class="c1">// gnl_utils</span>
<span class="kt">size_t</span>	<span class="nf">ft_strlen</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
<span class="kt">size_t</span>	<span class="nf">ft_strlcpy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">dstsize</span><span class="p">);</span>
<span class="kt">char</span>	<span class="o">*</span><span class="nf">ft_strjoin</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span><span class="p">);</span>
<span class="kt">char</span>	<span class="o">*</span><span class="nf">ft_strchr</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">);</span>
<span class="kt">void</span>	<span class="o">*</span><span class="nf">ft_calloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>

<span class="cp">#endif
</span></pre></table></code></div></div><h3 id="표준-라이브러리"><span class="mr-2">표준 라이브러리</span><a href="#표준-라이브러리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>stdlib.h<ul><li>malloc<li>free</ul><li>unistd.h<ul><li>read</ul></ul><h3 id="define"><span class="mr-2">#define</span><a href="#define" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>BUFFER_SIZE<ul><li>컴파일시에 정의되는 경우 고려해서 ifndef 사용</ul></ul><h1 id="bonus-part">Bonus part</h1><p>파일 디스크립터 여러개를 관리할 수 있는 함수 만들기.</p><h2 id="get_next_line-1"><span class="mr-2">get_next_line</span><a href="#get_next_line-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>변수<ul><li><code class="language-plaintext highlighter-rouge">static char *backup[OPEN_MAX + 1];</code> : 다음에 읽을 line의 시작 주소를 계속 저장해둘 변수</ul><li><p>정적변수의 사용</p><p><code class="language-plaintext highlighter-rouge">static char *backup[OPEN_MAX];</code>*</p><p><em><code class="language-plaintext highlighter-rouge">**</code></em> 과 같이 이중포인터를 사용한다면 array to pointer decay(배열의 크기를 잃어버리는 것)가 발생함</p><li>포인터 배열</ul><blockquote><p>배열의 요소로 포인터를 갖는 배열</p></blockquote><p>각각의 backup 배열의 요소에 각 fd에서 읽어들인 부분을 저장하기 위해 사용 <a href="http://www.tcpschool.com/c/c_pointerArray_arrayPointer">(참고)</a></p><ul><li>fd 유효성 체크 :<ul><li><code class="language-plaintext highlighter-rouge">fd &gt; OPEN_MAX</code> : read함수가 읽어들일 수 있는 최대 파일의 개수를 초과한 것</ul><li>배열의 크기 관련 <img data-src="/assets/img/42seoul/gnl/open%20max%20size.svg" alt="" data-proofer-ignore></ul><h2 id="header-1"><span class="mr-2">header</span><a href="#header-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>get_next_line_bonus.h</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="cp">#ifndef GET_NEXT_LINE_BONUS_H
# define GET_NEXT_LINE_BONUS_H
</span>
<span class="cp"># include &lt;stdlib.h&gt;
# include &lt;unistd.h&gt;
</span>
<span class="cp"># ifndef OPEN_MAX
#  define OPEN_MAX 256
# endif
</span>
<span class="cp"># ifndef BUFFER_SIZE
#  define BUFFER_SIZE 50
# endif
</span>
<span class="c1">// gnl</span>
<span class="kt">char</span>	<span class="o">*</span><span class="nf">get_next_line</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>

<span class="c1">// gnl_utils</span>
<span class="kt">size_t</span>	<span class="nf">ft_strlen</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
<span class="kt">size_t</span>	<span class="nf">ft_strlcpy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">dstsize</span><span class="p">);</span>
<span class="kt">char</span>	<span class="o">*</span><span class="nf">ft_strjoin</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span><span class="p">);</span>
<span class="kt">char</span>	<span class="o">*</span><span class="nf">ft_strchr</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">);</span>
<span class="kt">void</span>	<span class="o">*</span><span class="nf">ft_calloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>

<span class="cp">#endif
</span></pre></table></code></div></div><h1 id="test">Test</h1><h2 id="1-메인함수-활용"><span class="mr-2">1. 메인함수 활용</span><a href="#1-메인함수-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>test_main.c</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"get_next_line.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span>	<span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span>	<span class="o">*</span><span class="n">line</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">fd</span><span class="p">;</span>

	<span class="n">fd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"./test"</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
	<span class="n">line</span> <span class="o">=</span> <span class="s">"</span><span class="se">\0</span><span class="s">"</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">line</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">get_next_line</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
		<span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>테스트용 문서는 test라고 이름붙이고 같은 경로에 위치</p><h3 id="방법-1-buffer_size를-그대로-컴파일"><span class="mr-2">방법 1. BUFFER_SIZE를 그대로 컴파일</span><a href="#방법-1-buffer_size를-그대로-컴파일" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">gcc -Wall -Wextra -Werror get_next_line.c get_next_line_utils.c test_main.c</code></p><h3 id="방법-2-buffer_size를-변경하여-컴파일"><span class="mr-2">방법 2. BUFFER_SIZE를 변경하여 컴파일</span><a href="#방법-2-buffer_size를-변경하여-컴파일" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">gcc -Wall -Wextra -Werror -D BUFFER_SIZE=42 get_next_line.c get_next_line_utils.c test_main.c</code></p><p>BUFFER_SIZE 대신 OPEN_MAX를 넣어도 원하는 결과를 낼 수 있음 (표준 라이브러리(limits.h)를 include하지 않고 직접 상수를 define한 경우)</p><p><br /> <strong>gcc -D</strong></p><blockquote><p>gcc -D [name]=[definition]</p></blockquote><ul><li>#define을 프로그램 외부에서 정의하고 컴파일 시 반영할 수 있음<br /> <code class="language-plaintext highlighter-rouge">gcc -Wall -Wextra -Werror -D BUFFER_SIZE=42 get_next_line.c get_next_line_utils.c</code></ul><h2 id="2-테스터-활용"><span class="mr-2">2. 테스터 활용</span><a href="#2-테스터-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://github.com/Tripouille/gnlTester">gnlTester</a></p><ul><li>사용 방법<ul><li>make m : mandatory 테스트<li>make b : bonus 테스트<li>make a : 둘 다 테스트</ul></ul><h1 id="ref">Ref.</h1><p><a href="https://velog.io/@meong9090/getnextline-정적변수-static에-대해-알아보자">static 변수</a><br /> <a href="http://www.tcpschool.com/c/c_pointerArray_arrayPointer">포인터 배열</a><br /> <a href="https://gamguma.dev/post/2022/02/get_next_line">프로젝트 참고</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/42seoul/'>42Seoul</a>, <a href='/categories/get-next-line/'>get_next_line</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/42seoul/" class="post-tag no-text-decoration" >42seoul</a> <a href="/tags/c/" class="post-tag no-text-decoration" >c</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Get+Next+Line+%E2%91%A3+%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8+%EA%B5%AC%ED%98%84+%28Mandatory%2C+Bonus+part%29+-+Justnote&url=https%3A%2F%2F23tae.github.io%2Fposts%2Fgnl4%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Get+Next+Line+%E2%91%A3+%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8+%EA%B5%AC%ED%98%84+%28Mandatory%2C+Bonus+part%29+-+Justnote&u=https%3A%2F%2F23tae.github.io%2Fposts%2Fgnl4%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2F23tae.github.io%2Fposts%2Fgnl4%2F&text=Get+Next+Line+%E2%91%A3+%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8+%EA%B5%AC%ED%98%84+%28Mandatory%2C+Bonus+part%29+-+Justnote" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/os02/">[운영 체제] 02. Operating-System Structures</a><li><a href="/posts/os03/">[운영 체제] 03. Processes</a><li><a href="/posts/os04/">[운영 체제] 04. Thread & Concurrency</a><li><a href="/posts/minitalk3/">Minitalk ③ 배경 지식 : 기타</a><li><a href="/posts/push_swap1/">Push_swap ① Subject</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/42seoul/">42seoul</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/dp/">dp</a> <a class="post-tag" href="/tags/issue/">issue</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/vscode/">vscode</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/gnl1/"><div class="card-body"> <em class="small" data-ts="1652713200" data-df="ll" > May 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Get Next Line ① Subject</h3><div class="text-muted small"><p> Pdf Summary 이 프로젝트는 파일 디스크립터에서 읽은 행을 반환하는 함수를 프로그래밍하는 것입니다. Common Instructions 당신의 프로젝트는 C로 작성되어야 합니다. 당신의 프로젝트는 Norm 따라 작성되어야 합니다. 보너스 파일/함수가 있으면 norm 검사에 포함되며 내부에 norm 오류가 있으면 0점을 받게 됩니...</p></div></div></a></div><div class="card"> <a href="/posts/gnl2/"><div class="card-body"> <em class="small" data-ts="1652972400" data-df="ll" > May 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Get Next Line ② 배경 지식</h3><div class="text-muted small"><p> 과제를 위한 배경 지식 static 변수 메모리의 데이터 영역에 저장됨 프로그램이 종료될 때까지 유지됨 파일 디스크립터(fd) 특정한 파일에 접근하기 위한 추상적인 키 0,1,2는 표준 POSIX 파일 서술자로 각각 표준입력, 표준출력, 표준에러를 의미함 ...</p></div></div></a></div><div class="card"> <a href="/posts/gnl3/"><div class="card-body"> <em class="small" data-ts="1653577200" data-df="ll" > May 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Get Next Line ③ 방향 탐색</h3><div class="text-muted small"><p> 구현 방법 간략한 방법 ‘\n’가 포함된 버퍼까지 읽음 ‘\n’의 뒷부분 저장 계속 읽음 EOF가 나오면 중단 해결방향 포인터로 해결이 가능한 mandatory 파트와 달리 추가적인 fd를 고려해야 하는 bonus 파트의 경우 해결방법이 둘로 나뉜다. 포인터 배열을 활용한 풀이 (주로 OPEN_MAX) 가변크기 자료구...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dangling-pointer/" class="btn btn-outline-primary" prompt="Older"><p>Dangling pointer(댕글링 포인터)</p></a> <a href="/posts/printf-manual/" class="btn btn-outline-primary" prompt="Newer"><p>Printf Manual</p></a></div><script src="https://utteranc.es/client.js" repo="23tae/comments" issue-term="pathname" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/23tae">Taehoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/42seoul/">42seoul</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/dp/">dp</a> <a class="post-tag" href="/tags/issue/">issue</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/vscode/">vscode</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
