---
title:  "Minitalk â‘£ í”„ë¡œì íŠ¸ êµ¬í˜„"
categories: [42Seoul, Minitalk]
tags: [42seoul]
date: 2022-07-18
---

![preview](/assets/img/42seoul/minitalk/mini4/preview.gif)

# êµ¬í˜„í•œ ê¸°ëŠ¥
## server
- server pid ì¶œë ¥
- ì‹œê·¸ë„ ìˆ˜ì‹ 
- ë©”ì‹œì§€ ì¶œë ¥
- ë°œì†¡ì¸ì˜ pid ì¶œë ¥
- ë°›ì€ ë°”ì´íŠ¸ ì¶œë ¥
- ë©”ì‹œì§€ ìˆ˜ì‹  ì—¬ë¶€ ì¶œë ¥

## client
- client pid ì¶œë ¥
- ì—°ê²° ì—¬ë¶€ ì¶œë ¥
- ì‹œê·¸ë„ ì „ì†¡
- ë³´ë‚¸ ë°”ì´íŠ¸ ì¶œë ¥
- ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ ì—¬ë¶€ ì¶œë ¥

# ë°©ë²• êµ¬ìƒ

1. server on
2. client on
3. client send message (str â†’ char â†’ bit â†’ signal)
4. server get message
5. server print message
6. server end

# ë°©ë²• ìˆ˜ì •

- 3-way handshakeë¥¼ í™œìš©í•´ ì—°ê²°
- ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì‹œê·¸ë„ì„ ì£¼ê³ ë°›ìœ¼ë©° ìˆ˜ì‹ ì—¬ë¶€ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì²´í¬í•¨
- ë©”ëª¨ë¦¬ë¥¼ ì¼ì •í•œ í¬ê¸°ë§Œí¼ í• ë‹¹í•œ í›„ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•´ê°€ë©° ì‚¬ìš©

ì²« êµ¬í˜„ì—ì„œëŠ” clientê°€ ì—°ê²° ì„±ê³µ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ë°”ë¡œ ì‹œê·¸ë„ì„ ì „ì†¡í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ 3-way handshake ë°©ì‹ì„ í™œìš©í•´ ì—°ê²° ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì˜€ë‹¤.  
clientê°€ serverì—ê²Œ ì‹œê·¸ë„ì„ ë³´ë‚´ë©´ serverëŠ” ë°›ì€ ì‹œê·¸ë„ì— 1ì„ ë”í•´ì„œ ë°˜ì†¡í•œë‹¤. clientëŠ” ì‹œê·¸ë„ì´ ì œëŒ€ë¡œ ìˆ˜ì‹ ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•œ í›„ì— ì„±ê³µì—¬ë¶€ë¥¼ ì¶œë ¥í•œë‹¤.

ì‹œê·¸ë„ì„ ê³„ì†í•´ì„œ ë³´ë‚´ê²Œ ë˜ë©´ ì‹œê·¸ë„ì´ ì˜ëª» ìˆ˜ì‹ ë˜ëŠ” ê²½ìš°ê°€ ìƒê¸°ëŠ”ë° ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê¸°ì¡´ì—ëŠ” usleep(100)ê³¼ ê°™ì´ ì¼ì •í•œ ë”œë ˆì´ë¥¼ ë‘ì–´ ì‹œê·¸ë„ì„ ì „ì†¡í–ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ ì½”ë“œëŠ” ê¸´ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ íš¨ìœ¨ì„±ì´ ë–¨ì–´ì§„ë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•œë‹¤.   ë”°ë¼ì„œ clientê°€ ë§¤ ì‹œê·¸ë„ì„ ë³´ë‚¼ ë•Œë§ˆë‹¤ serverë„ ì´ì— ë‹µí•˜ëŠ” ì‹œê·¸ë„ì„ ë³´ë‚´ ìˆ˜ì‹  ì—¬ë¶€ë¥¼ ì²´í¬í•˜ë„ë¡ í–ˆë‹¤.

# í—¤ë” íŒŒì¼

```c
typedef struct s_data
{
	struct sigaction	action_handshake;
	struct sigaction	action_transmission;
	pid_t			pid;
	char			*message;
	int			byte;
}	t_data;
```

ìœ„ì™€ ê°™ì€ êµ¬ì¡°ì²´ë¥¼ ì „ì—­ìœ¼ë¡œ ì„ ì–¸í•´ì„œ ì‚¬ìš©

- sigaction êµ¬ì¡°ì²´
    - action_handshake : 3-way handshakeë¥¼ í†µí•´ ì—°ê²°ì„ í™•ì¸í•¨
    - action_transmission : ë“¤ì–´ì˜¤ëŠ” ì‹œê·¸ë„ì„ ë°›ì•„ì„œ ë©”ì‹œì§€ë¡œ ë³€í™˜í•˜ê±°ë‚˜ ì¢…ë£Œì—¬ë¶€ë¥¼ íŒŒì•…í•¨
- pid
    
    ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ë ¤ëŠ” ìƒëŒ€ë°©ì˜ Process IDë¥¼ ì €ì¥í•¨
    
	- PID : ìš´ì˜ì²´ì œê°€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ ë¶€ì—¬í•œ ë²ˆí˜¸
    - `pid_t` ìë£Œí˜•
        - pidë¥¼ ì €ì¥í•˜ëŠ” ìë£Œí˜•
        - sys/types.h ì— ì„ ì–¸ë¨
        - ì‹œìŠ¤í…œì— ë”°ë¼ í”„ë¡œì„¸ìŠ¤ê°€ intí˜•ì´ ì•„ë‹Œ ê²½ìš°ê°€ ìˆì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©
- message
    - Client : ì „ì†¡í•˜ë ¤ëŠ” ë©”ì‹œì§€ë¥¼ ì €ì¥í•¨
    - Server : ìˆ˜ì‹ í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê¸° ì „ê¹Œì§€ ì €ì¥í•¨
- byte
    
    ì†¡ìˆ˜ì‹ ëœ ë©”ì‹œì§€ì˜ ë°”ì´íŠ¸ë¥¼ ì €ì¥í•¨
    
# êµ¬ì„±
## client
### client.c
- `check_argument` : ëª…ë ¹í–‰ ì¸ìì˜ ìœ íš¨ì„± ì²´í¬
- `init` : ì´ˆê¸° ì„¤ì • (ê°ì¢… ë³€ìˆ˜ ì´ˆê¸°í™”, sigaction ì„¤ì •, í˜„ì¬ Process ID ì¶œë ¥)
- `handshake_syn` : 3-way handshake 1ë‹¨ê³„. 
- `handshake_ack` : 3-way handshake 3ë‹¨ê³„. ìˆ˜ì‹ ëœ ì‹œê·¸ë„ì„ í™•ì¸í•´ ì—°ê²°ì˜ ì„±ê³µì—¬ë¶€ ì²´í¬

### client_transmit.c
- `ft_send_or_end` : serverê°€ ë³´ë‚¸ ì‹œê·¸ë„ì— ë”°ë¼ ì¢…ë£Œ ì—¬ë¶€ ê²°ì •
- `ft_send_message` : ë³´ë‚¼ ë©”ì‹œì§€ë¥¼ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ í•¨ìˆ˜ í˜¸ì¶œ
- `send_signal` : í•´ë‹¹ ë°”ì´íŠ¸ì˜ ê° ë¹„íŠ¸ ê°’ì— ë”°ë¼ ì‹œê·¸ë„ ì „ì†¡

### utils.c
- `ft_kill` : kill í•¨ìˆ˜ë¥¼ ë³€í˜•
- `ft_error` : ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥ í›„ ì¢…ë£Œ

## server
### server.c
- `init` : ì´ˆê¸° ì„¤ì • (ê°ì¢… ë³€ìˆ˜ ì´ˆê¸°í™”, sigaction ì„¤ì •, ë©”ëª¨ë¦¬ í• ë‹¹, í˜„ì¬ Process ID ì¶œë ¥)
- `handshake_synack` : 3-way handshake 2ë‹¨ê³„. ë°›ì€ ì‹œê·¸ë„ì— 1ì„ ë”í•œ ì‹œê·¸ë„ì„ ë³´ë‚¸ pidì—ê²Œ ì „ì†¡

### server_transmit.c
- `ft_receive_signal` : ìˆ˜ì‹ ëœ ì‹œê·¸ë„ì„ ì²˜ë¦¬í•  í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í›„ ì¢…ë£Œ ì—¬ë¶€ ì²´í¬
- `signal_to_char` : (ìˆ˜ì‹ ëœ ì‹œê·¸ë„ì— í•´ë‹¹í•˜ëŠ”) ë¹„íŠ¸ë¥¼ ë°°ì—´ì˜ ê°’ì— ë”í•´ì¤Œ
- `print_message` : ë©”ì‹œì§€ ì¶œë ¥

### utils.c
- ìœ„ì™€ ë™ì¼

# ë™ì‘ ê³¼ì •

## Server

- ì…ë ¥ëœ ì¸ìë¥¼ ì²´í¬
- inití•¨ìˆ˜ë¥¼ í†µí•´ ê° ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”
- sigaction í•¨ìˆ˜ì˜ êµ¬ì¡°ì²´ë¥¼ ì„¤ì •(í•¸ë“¤ëŸ¬, í”Œë˜ê·¸, ë§ˆìŠ¤í¬ ë“±)
- message í¬ì¸í„°ì— 100ë§Œí¼ ë©”ëª¨ë¦¬ í• ë‹¹í•œ í›„ 0ìœ¼ë¡œ ì±„ì›€
- ë¬´í•œë£¨í”„ë¥¼ ëŒë©° ì‹ í˜¸ë¥¼ ê¸°ë‹¤ë¦¼
- ì‹ í˜¸ê°€ ë“¤ì–´ì˜¤ë©´ í•¸ë“¤ëŸ¬ì¸ handshake_synackê°€ ì‹¤í–‰ë˜ì–´ ë“¤ì–´ì˜¨ ê°’ì— 1ì„ ë”í•´ clientì— ì „ì†¡í•¨
- sigactionì˜ êµ¬ì¡°ì²´ë¥¼ ë³€ê²½í•´ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•  ì¤€ë¹„ë¥¼ í•¨
- ë©”ì‹œì§€ê°€ ë“¤ì–´ì˜¤ë©´ pidë¥¼ ì²´í¬í•œ í›„ì— ì´ìƒì´ ìˆìœ¼ë©´ ë“¤ì–´ì˜¨ ì‹œê·¸ë„ì„ ê·¸ëŒ€ë¡œ ì „ì†¡í•˜ê±°ë‚˜ í•¸ë“¤ëŸ¬ë¥¼ ì¢…ë£Œì‹œí‚´
- ì´ìƒì´ ì—†ìœ¼ë©´ 0ë²ˆ ì¸ë±ìŠ¤ë¶€í„° ë¹„íŠ¸ì‹œí”„íŠ¸ë¥¼ í†µí•´ ê°’ì„ ì±„ì›Œë‚˜ê°. (ì´ë•Œ, ì‹œê·¸ë„ í•˜ë‚˜ë¥¼ ë°›ì„ë•Œë§ˆë‹¤ clientì— ì¢…ë£Œì—¬ë¶€ë¥¼ ì‹œê·¸ë„ë¡œ ë³´ëƒ„)
- ë„ë¬¸ìë¥¼ ë§Œë‚˜ë©´ ë¬¸ìë¥¼ ì¶œë ¥í•œ í›„ì— ì„¸ë¶€ì‚¬í•­ì„ ì¶œë ¥í•˜ê³  sigactionì˜ êµ¬ì¡°ì²´ë¥¼ ë³€ê²½í•œ í›„ ì¢…ë£Œì‹ í˜¸ë¥¼ ë³´ëƒ„
- 100ì¹¸ì„ ë‹¤ ì±„ì› ë‹¤ë©´ ë¬¸ìë¥¼ ì¶œë ¥í•˜ê³  ë‹¤ì‹œ ì…ë ¥ì„ ë°›ìŒ

## Client

- ì…ë ¥í•œ ì¸ìë¥¼ ì²´í¬í•œ í›„ pidì— ì €ì¥í•¨
- inití•¨ìˆ˜ë¡œ ë³€ìˆ˜ë“¤ì„ ì´ˆê¸°í™”í•´ì¤€ í›„ sigactioní•¨ìˆ˜ì— handshake êµ¬ì¡°ì²´ë¥¼ ì„¤ì •í•¨
- pidì— SIGUSR1ì„ ì†¡ì‹ í•¨
- ë³´ë‚´ì¤€ ì‹œê·¸ë„ì— 1ì´ ë”í•´ì§„ ê°’ì´ ìˆ˜ì‹ ë˜ë©´ handshake ì„±ê³µ
- ë“¤ì–´ì˜¨ ê°’ì´ ë‹¤ë¥´ê±°ë‚˜ ìˆ˜ì‹ ëœ pidê°€ ë‹¤ë¥´ë©´ ì¼ì •íšŸìˆ˜ë™ì•ˆ ë‹¤ì‹œ ì—°ê²°ì„ ì‹œë„í•œ í›„ ì¢…ë£Œ
- send_message í•¨ìˆ˜ë¥¼ í†µí•´ messageë¥¼ ë¹„íŠ¸ë‹¨ìœ„ë¡œ ìª¼ê°œì–´ ì‹œê·¸ë„ì„ ì „ì†¡ (í•´ë‹¹ ìë¦¬ì˜ ë¹„íŠ¸ê°€ 1ì´ë©´ USR1ì„, 0ì´ë©´ USR2ë¥¼ ì „ì†¡í•¨)
- ë³´ë‚¸ pidë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ë°›ì•˜ë‹¤ëŠ” ì‹œê·¸ë„ì„ ë°›ìœ¼ë©´ ì¢…ë£Œì—¬ë¶€ì— ë”°ë¼ ì´ì–´ì„œ ì „ì†¡í•˜ê±°ë‚˜(SIGUSR1) ì „ì†¡ì„ ì¢…ë£Œí•¨(SIGUSR2)
- ì „ì†¡ì„ ë§ˆì¹˜ë©´ ì „ì†¡í•œ ë°”ì´íŠ¸ì™€ ì„±ê³µ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•¨

# ì˜ˆì™¸ ì²˜ë¦¬

## Server

- ëª…ë ¹í–‰ ì¸ìê°€ ë“¤ì–´ì˜´
![](/assets/img/42seoul/minitalk/mini4/exception-3.png)
- ì‹œê·¸ë„ì„ ë³´ë‚¸ ë°œì†¡ì¸ì˜ pidê°€ ê¸°ì¡´ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë˜ clientê°€ ì•„ë‹Œ ê²½ìš°

## Client

- ëª…ë ¹í–‰ ì¸ìê°€ `./client [PID] [Message]` ì˜ í˜•íƒœê°€ ì•„ë‹˜
![](/assets/img/42seoul/minitalk/mini4/exception-1.png)
- ëª…ë ¹í–‰ ì¸ìì˜ pidê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ(ì •ìˆ˜ê°€ ì•„ë‹Œ ê²½ìš°)
![](/assets/img/42seoul/minitalk/mini4/exception-4.png)
- ëª…ë ¹í–‰ ì¸ìì˜ pidê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ(serverì˜ pidê°€ ì•„ë‹Œ ê²½ìš°)
![](/assets/img/42seoul/minitalk/mini4/exception-2.png)

# í…ŒìŠ¤íŠ¸

![](/assets/img/42seoul/minitalk/mini4/transmission-1.png)

- ì¼ë°˜ ë©”ì‹œì§€ (ë©”ì‹œì§€ì— ê³µë°±ì´ ìˆìœ¼ë©´ í°ë”°ì˜´í‘œë¡œ ë¬¶ì–´ì„œ ì…ë ¥í•´ì•¼í•¨)
    
    ```
    hello world
    ```
![](/assets/img/42seoul/minitalk/mini4/transmission-2.png)
![](/assets/img/42seoul/minitalk/mini4/transmission-3.png)
- 100ì ë©”ì‹œì§€
    
    ```
    LoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumd
    ```

    
- 500ì
    
    ```
    LoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdoLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdoLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdoLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdoLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumdolorsitametLoremipsumd
    ```
![](/assets/img/42seoul/minitalk/mini4/transmission-4.png)
![](/assets/img/42seoul/minitalk/mini4/transmission-5.png)
    
- ìœ ë‹ˆì½”ë“œ 1
    
    ```
    ğŸ˜€ğŸ¶ğŸğŸ€ğŸš—ğŸ’¡
    ```
![](/assets/img/42seoul/minitalk/mini4/transmission-6.png)
![](/assets/img/42seoul/minitalk/mini4/transmission-7.png)
    
- ìœ ë‹ˆì½”ë“œ 2
    
    ```
    ë©”ì‹œì§€í…ŒìŠ¤íŠ¸
    ```
![](/assets/img/42seoul/minitalk/mini4/transmission-8.png)
![](/assets/img/42seoul/minitalk/mini4/transmission-9.png)

# í‰ê°€ í›„ê¸°
## ë¶€ì¡±í•œ ê°œë…

- sigaction í•¨ìˆ˜ì™€ ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ (ì„¸ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì˜ ì—­í• )
- sigemptyset, sigaddsetì˜ ì‚¬ìš© ë°©ë²•
- makefile (í—¤ë”íŒŒì¼ include, addprefix, patsubst ë“±)

## ê°œì„ í•  ë¶€ë¶„

- ì²«ê¸€ìê°€ ë‹¤ë¥´ê²Œ ì¶œë ¥ë˜ëŠ” ì¼€ì´ìŠ¤ê°€ ì¡´ì¬
	- kill í•¨ìˆ˜ë¥¼ í†µí•´ ì‹œê·¸ë„ì„ ì£¼ê³ ë°›ì„ ë•Œ ë”œë ˆì´ë¥¼ ì „í˜€ ì£¼ì§€ ì•Šì•„ì„œ ìƒê¸°ëŠ” ë¬¸ì œë¡œ ë³´ì„
	- ft_kill í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ ì‹œê·¸ë„ì„ ì „ì†¡í•˜ê¸° ì „ì— usleepìœ¼ë¡œ 10ë§ˆì´í¬ë¡œì´ˆë§Œí¼ì˜ ë”œë ˆì´ë¥¼ ë°œìƒì‹œí‚´

# Ref.
<https://velog.io/@bahn/Minitalk>  